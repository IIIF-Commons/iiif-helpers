import type { Selector } from '@iiif/presentation-3';
import { JSDOM } from 'jsdom';
import { describe, expect, test } from 'vitest';
import ghentChoices from '../fixtures/presentation-3/ghent-choices.json';
import { expandTarget } from '../src';
import { parseSelector } from '../src/annotation-targets/parse-selector';

describe('parse selector', () => {
  describe('SVG Selectors', () => {
    test('Parsing a rectangle selector', () => {
      expect(
        parseSelector({
          type: 'SvgSelector',
          value:
            '<svg width="800" height="600" xmlns="http://www.w3.org/2000/svg"><g><rect x="100" y="100" width="300" height="300" stroke="#000" fill="#fff"/></g></svg>',
        })
      ).toMatchInlineSnapshot(`
      {
        "selector": {
          "points": [
            [
              100,
              100,
            ],
            [
              400,
              100,
            ],
            [
              400,
              400,
            ],
            [
              100,
              400,
            ],
            [
              100,
              100,
            ],
          ],
          "spatial": {
            "height": 300,
            "unit": "pixel",
            "width": 300,
            "x": 100,
            "y": 100,
          },
          "style": {
            "fill": "#fff",
            "stroke": "#000",
          },
          "svg": "<svg width="800" height="600" xmlns="http://www.w3.org/2000/svg"><g><rect x="100" y="100" width="300" height="300"></rect></g></svg>",
          "svgShape": "rect",
          "type": "SvgSelector",
        },
        "selectors": [
          {
            "points": [
              [
                100,
                100,
              ],
              [
                400,
                100,
              ],
              [
                400,
                400,
              ],
              [
                100,
                400,
              ],
              [
                100,
                100,
              ],
            ],
            "spatial": {
              "height": 300,
              "unit": "pixel",
              "width": 300,
              "x": 100,
              "y": 100,
            },
            "style": {
              "fill": "#fff",
              "stroke": "#000",
            },
            "svg": "<svg width="800" height="600" xmlns="http://www.w3.org/2000/svg"><g><rect x="100" y="100" width="300" height="300"></rect></g></svg>",
            "svgShape": "rect",
            "type": "SvgSelector",
          },
        ],
      }
    `);
    });

    test('Parsing svg with temporal element', () => {
      expect(
        parseSelector([
          {
            type: 'SvgSelector',
            value:
              '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 4512 6174" width="4512" height="6174"><polygon points="3069,1586 3069,1616 3100,1586 3100,1616" /></svg>',
          },
          {
            type: 'FragmentSelector',
            conformsTo: 'http://www.w3.org/TR/media-frags/',
            value: 't=10.46,10.46',
          },
        ])
      ).toMatchInlineSnapshot(`
        {
          "selector": {
            "points": [
              [
                3069,
                1586,
              ],
              [
                3069,
                1616,
              ],
              [
                3100,
                1586,
              ],
              [
                3100,
                1616,
              ],
              [
                3069,
                1586,
              ],
            ],
            "spatial": {
              "height": 30,
              "unit": "pixel",
              "width": 31,
              "x": 3069,
              "y": 1586,
            },
            "style": undefined,
            "svg": "<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 4512 6174" width="4512" height="6174"><polygon points="3069,1586 3069,1616 3100,1586 3100,1616"></polygon></svg>",
            "svgShape": "polygon",
            "temporal": {
              "endTime": 10.46,
              "startTime": 10.46,
            },
            "type": "SvgSelector",
          },
          "selectors": [
            {
              "points": [
                [
                  3069,
                  1586,
                ],
                [
                  3069,
                  1616,
                ],
                [
                  3100,
                  1586,
                ],
                [
                  3100,
                  1616,
                ],
                [
                  3069,
                  1586,
                ],
              ],
              "spatial": {
                "height": 30,
                "unit": "pixel",
                "width": 31,
                "x": 3069,
                "y": 1586,
              },
              "style": undefined,
              "svg": "<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 4512 6174" width="4512" height="6174"><polygon points="3069,1586 3069,1616 3100,1586 3100,1616"></polygon></svg>",
              "svgShape": "polygon",
              "temporal": {
                "endTime": 10.46,
                "startTime": 10.46,
              },
              "type": "SvgSelector",
            },
            {
              "temporal": {
                "endTime": 10.46,
                "startTime": 10.46,
              },
              "type": "TemporalSelector",
            },
          ],
        }
      `);
    });

    test('Parsing svg without size', () => {
      expect(
        parseSelector({
          type: 'SvgSelector',
          value:
            '<svg xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" fill="#FF0055" stroke="#FF0055" stroke-width="1" fill-opacity="0.1" d="M 2596,6948 L 2571,6952 L 2597,6959 L 2616,6953 L 2596,6948 Z"/></svg>',
        })
      ).toMatchInlineSnapshot(`
        {
          "selector": {
            "points": [
              [
                2596,
                6948,
              ],
              [
                2571,
                6952,
              ],
              [
                2597,
                6959,
              ],
              [
                2616,
                6953,
              ],
              [
                2596,
                6948,
              ],
              [
                2596,
                6948,
              ],
            ],
            "spatial": {
              "height": 11,
              "unit": "pixel",
              "width": 45,
              "x": 2571,
              "y": 6948,
            },
            "style": {
              "fill": "#FF0055",
              "fillOpacity": 0.1,
              "stroke": "#FF0055",
              "strokeWidth": "1",
            },
            "svg": "<svg xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M 2596,6948 L 2571,6952 L 2597,6959 L 2616,6953 L 2596,6948 Z"></path></svg>",
            "svgShape": "polygon",
            "type": "SvgSelector",
          },
          "selectors": [
            {
              "points": [
                [
                  2596,
                  6948,
                ],
                [
                  2571,
                  6952,
                ],
                [
                  2597,
                  6959,
                ],
                [
                  2616,
                  6953,
                ],
                [
                  2596,
                  6948,
                ],
                [
                  2596,
                  6948,
                ],
              ],
              "spatial": {
                "height": 11,
                "unit": "pixel",
                "width": 45,
                "x": 2571,
                "y": 6948,
              },
              "style": {
                "fill": "#FF0055",
                "fillOpacity": 0.1,
                "stroke": "#FF0055",
                "strokeWidth": "1",
              },
              "svg": "<svg xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M 2596,6948 L 2571,6952 L 2597,6959 L 2616,6953 L 2596,6948 Z"></path></svg>",
              "svgShape": "polygon",
              "type": "SvgSelector",
            },
          ],
        }
      `);
    });

    test('Parsing a circle selector', () => {
      expect(
        parseSelector({
          type: 'SvgSelector',
          value:
            '<svg width="800" height="600" xmlns="http://www.w3.org/2000/svg"><g><circle r="147.5" cy="199.83333" cx="225.5" stroke="#000" fill="#fff"/></g></svg>',
        })
      ).toMatchInlineSnapshot(`
      {
        "selector": {
          "points": [
            [
              373,
              199.83333,
            ],
            [
              369.77677110823635,
              230.50030439561948,
            ],
            [
              360.2479550022836,
              259.82698485368053,
            ],
            [
              344.8300066703048,
              286.5316547131398,
            ],
            [
              324.1967644379316,
              309.4471917579157,
            ],
            [
              299.25,
              327.5720770582047,
            ],
            [
              271.0800066703047,
              340.11416615353517,
            ],
            [
              240.9179483319789,
              346.5253095668203,
            ],
            [
              210.08205166802114,
              346.5253095668203,
            ],
            [
              179.91999332969527,
              340.11416615353517,
            ],
            [
              151.75000000000003,
              327.5720770582047,
            ],
            [
              126.80323556206841,
              309.4471917579157,
            ],
            [
              106.16999332969527,
              286.5316547131398,
            ],
            [
              90.75204499771638,
              259.82698485368053,
            ],
            [
              81.22322889176365,
              230.50030439561948,
            ],
            [
              78,
              199.83333000000002,
            ],
            [
              81.22322889176365,
              169.16635560438053,
            ],
            [
              90.75204499771633,
              139.8396751463195,
            ],
            [
              106.16999332969525,
              113.13500528686022,
            ],
            [
              126.80323556206838,
              90.21946824208437,
            ],
            [
              151.74999999999994,
              72.09458294179531,
            ],
            [
              179.91999332969525,
              59.55249384646484,
            ],
            [
              210.08205166802114,
              53.14135043317967,
            ],
            [
              240.9179483319788,
              53.14135043317967,
            ],
            [
              271.0800066703047,
              59.55249384646481,
            ],
            [
              299.25,
              72.0945829417953,
            ],
            [
              324.1967644379315,
              90.21946824208429,
            ],
            [
              344.8300066703047,
              113.13500528686016,
            ],
            [
              360.2479550022837,
              139.83967514631945,
            ],
            [
              369.7767711082363,
              169.1663556043804,
            ],
            [
              373,
              199.83332999999996,
            ],
          ],
          "spatial": {
            "height": 293.3839591336406,
            "unit": "pixel",
            "width": 295,
            "x": 78,
            "y": 53.14135043317967,
          },
          "style": {
            "fill": "#fff",
            "stroke": "#000",
          },
          "svg": "<svg width="800" height="600" xmlns="http://www.w3.org/2000/svg"><g><circle r="147.5" cy="199.83333" cx="225.5"></circle></g></svg>",
          "svgShape": "circle",
          "type": "SvgSelector",
        },
        "selectors": [
          {
            "points": [
              [
                373,
                199.83333,
              ],
              [
                369.77677110823635,
                230.50030439561948,
              ],
              [
                360.2479550022836,
                259.82698485368053,
              ],
              [
                344.8300066703048,
                286.5316547131398,
              ],
              [
                324.1967644379316,
                309.4471917579157,
              ],
              [
                299.25,
                327.5720770582047,
              ],
              [
                271.0800066703047,
                340.11416615353517,
              ],
              [
                240.9179483319789,
                346.5253095668203,
              ],
              [
                210.08205166802114,
                346.5253095668203,
              ],
              [
                179.91999332969527,
                340.11416615353517,
              ],
              [
                151.75000000000003,
                327.5720770582047,
              ],
              [
                126.80323556206841,
                309.4471917579157,
              ],
              [
                106.16999332969527,
                286.5316547131398,
              ],
              [
                90.75204499771638,
                259.82698485368053,
              ],
              [
                81.22322889176365,
                230.50030439561948,
              ],
              [
                78,
                199.83333000000002,
              ],
              [
                81.22322889176365,
                169.16635560438053,
              ],
              [
                90.75204499771633,
                139.8396751463195,
              ],
              [
                106.16999332969525,
                113.13500528686022,
              ],
              [
                126.80323556206838,
                90.21946824208437,
              ],
              [
                151.74999999999994,
                72.09458294179531,
              ],
              [
                179.91999332969525,
                59.55249384646484,
              ],
              [
                210.08205166802114,
                53.14135043317967,
              ],
              [
                240.9179483319788,
                53.14135043317967,
              ],
              [
                271.0800066703047,
                59.55249384646481,
              ],
              [
                299.25,
                72.0945829417953,
              ],
              [
                324.1967644379315,
                90.21946824208429,
              ],
              [
                344.8300066703047,
                113.13500528686016,
              ],
              [
                360.2479550022837,
                139.83967514631945,
              ],
              [
                369.7767711082363,
                169.1663556043804,
              ],
              [
                373,
                199.83332999999996,
              ],
            ],
            "spatial": {
              "height": 293.3839591336406,
              "unit": "pixel",
              "width": 295,
              "x": 78,
              "y": 53.14135043317967,
            },
            "style": {
              "fill": "#fff",
              "stroke": "#000",
            },
            "svg": "<svg width="800" height="600" xmlns="http://www.w3.org/2000/svg"><g><circle r="147.5" cy="199.83333" cx="225.5"></circle></g></svg>",
            "svgShape": "circle",
            "type": "SvgSelector",
          },
        ],
      }
    `);
    });

    test('Parsing an ellipse selector', () => {
      expect(
        parseSelector({
          type: 'SvgSelector',
          value:
            '<svg width="800" height="600" xmlns="http://www.w3.org/2000/svg"><g><ellipse ry="31.5" rx="346.5" id="svg_2" cy="77.83333" cx="399.5" stroke="#000" fill="#fff"/></g></svg>',
        })
      ).toMatchInlineSnapshot(`
      {
        "selector": {
          "points": [
            [
              746,
              77.83333,
            ],
            [
              738.4281436542635,
              84.38254826075942,
            ],
            [
              716.0435010731612,
              90.64553425688771,
            ],
            [
              679.8243885509194,
              96.3485654472129,
            ],
            [
              631.3537551033444,
              101.24239200253791,
            ],
            [
              572.75,
              105.11313021920982,
            ],
            [
              506.5743885509193,
              107.79161026329734,
            ],
            [
              435.71911252224197,
              109.16076970410062,
            ],
            [
              363.2808874777581,
              109.1607697041006,
            ],
            [
              292.42561144908075,
              107.79161026329734,
            ],
            [
              226.25000000000006,
              105.11313021920982,
            ],
            [
              167.6462448966557,
              101.24239200253793,
            ],
            [
              119.17561144908075,
              96.3485654472129,
            ],
            [
              82.95649892683878,
              90.6455342568877,
            ],
            [
              60.57185634573631,
              84.38254826075942,
            ],
            [
              53,
              77.83333,
            ],
            [
              60.57185634573631,
              71.28411173924059,
            ],
            [
              82.95649892683872,
              65.02112574311231,
            ],
            [
              119.17561144908069,
              59.3180945527871,
            ],
            [
              167.64624489665556,
              54.424267997462096,
            ],
            [
              226.24999999999983,
              50.5535297807902,
            ],
            [
              292.42561144908063,
              47.875049736702664,
            ],
            [
              363.28088747775786,
              46.5058902958994,
            ],
            [
              435.7191125222421,
              46.50589029589939,
            ],
            [
              506.57438855091925,
              47.875049736702664,
            ],
            [
              572.75,
              50.553529780790186,
            ],
            [
              631.3537551033445,
              54.424267997462096,
            ],
            [
              679.8243885509191,
              59.318094552787095,
            ],
            [
              716.0435010731612,
              65.0211257431123,
            ],
            [
              738.4281436542635,
              71.28411173924057,
            ],
            [
              746,
              77.83332999999999,
            ],
          ],
          "spatial": {
            "height": 62.654879408201225,
            "unit": "pixel",
            "width": 693,
            "x": 53,
            "y": 46.50589029589939,
          },
          "style": {
            "fill": "#fff",
            "stroke": "#000",
          },
          "svg": "<svg width="800" height="600" xmlns="http://www.w3.org/2000/svg"><g><ellipse ry="31.5" rx="346.5" id="svg_2" cy="77.83333" cx="399.5"></ellipse></g></svg>",
          "svgShape": "ellipse",
          "type": "SvgSelector",
        },
        "selectors": [
          {
            "points": [
              [
                746,
                77.83333,
              ],
              [
                738.4281436542635,
                84.38254826075942,
              ],
              [
                716.0435010731612,
                90.64553425688771,
              ],
              [
                679.8243885509194,
                96.3485654472129,
              ],
              [
                631.3537551033444,
                101.24239200253791,
              ],
              [
                572.75,
                105.11313021920982,
              ],
              [
                506.5743885509193,
                107.79161026329734,
              ],
              [
                435.71911252224197,
                109.16076970410062,
              ],
              [
                363.2808874777581,
                109.1607697041006,
              ],
              [
                292.42561144908075,
                107.79161026329734,
              ],
              [
                226.25000000000006,
                105.11313021920982,
              ],
              [
                167.6462448966557,
                101.24239200253793,
              ],
              [
                119.17561144908075,
                96.3485654472129,
              ],
              [
                82.95649892683878,
                90.6455342568877,
              ],
              [
                60.57185634573631,
                84.38254826075942,
              ],
              [
                53,
                77.83333,
              ],
              [
                60.57185634573631,
                71.28411173924059,
              ],
              [
                82.95649892683872,
                65.02112574311231,
              ],
              [
                119.17561144908069,
                59.3180945527871,
              ],
              [
                167.64624489665556,
                54.424267997462096,
              ],
              [
                226.24999999999983,
                50.5535297807902,
              ],
              [
                292.42561144908063,
                47.875049736702664,
              ],
              [
                363.28088747775786,
                46.5058902958994,
              ],
              [
                435.7191125222421,
                46.50589029589939,
              ],
              [
                506.57438855091925,
                47.875049736702664,
              ],
              [
                572.75,
                50.553529780790186,
              ],
              [
                631.3537551033445,
                54.424267997462096,
              ],
              [
                679.8243885509191,
                59.318094552787095,
              ],
              [
                716.0435010731612,
                65.0211257431123,
              ],
              [
                738.4281436542635,
                71.28411173924057,
              ],
              [
                746,
                77.83332999999999,
              ],
            ],
            "spatial": {
              "height": 62.654879408201225,
              "unit": "pixel",
              "width": 693,
              "x": 53,
              "y": 46.50589029589939,
            },
            "style": {
              "fill": "#fff",
              "stroke": "#000",
            },
            "svg": "<svg width="800" height="600" xmlns="http://www.w3.org/2000/svg"><g><ellipse ry="31.5" rx="346.5" id="svg_2" cy="77.83333" cx="399.5"></ellipse></g></svg>",
            "svgShape": "ellipse",
            "type": "SvgSelector",
          },
        ],
      }
    `);
    });

    test('Parsing a cubic bézier selector', () => {
      expect(
        parseSelector({
          type: 'SvgSelector',
          value:
            '<svg width="800" height="600" xmlns="http://www.w3.org/2000/svg"><g><path d="m200.00001,83.33333c-270.12536,222.67568 -108.78352,-65.06757 -80.05978,107" stroke="#000" fill="#fff"/></g></svg>',
        })
      ).toMatchInlineSnapshot(`
      {
        "selector": {
          "points": [
            [
              200.00001,
              83.33333,
            ],
            [
              189.0497197575205,
              92.24393388115851,
            ],
            [
              178.805670397455,
              100.43438771718232,
            ],
            [
              169.23560567208767,
              107.94149345372949,
            ],
            [
              160.30805901686495,
              114.80115206593804,
            ],
            [
              151.99235355030802,
              121.0483635582994,
            ],
            [
              144.25860207390545,
              126.71722696450647,
            ],
            [
              137.07770707198566,
              131.84094034726937,
            ],
            [
              130.4213607115608,
              136.45180079809205,
            ],
            [
              123.61277681832797,
              141.00964477236283,
            ],
            [
              113.97516170198546,
              147.21988073927787,
            ],
            [
              105.3319030967066,
              152.52755936098924,
            ],
            [
              97.61454532645207,
              157.00342065751718,
            ],
            [
              90.75699356146032,
              160.71576500806725,
            ],
            [
              84.69551381892782,
              163.7304531473643,
            ],
            [
              79.36873296390102,
              166.11090616086344,
            ],
            [
              71.80644334525853,
              168.98320166402587,
            ],
            [
              64.26398773055817,
              171.19491342158602,
            ],
            [
              58.37447362500575,
              172.16184015700756,
            ],
            [
              53.9520687744154,
              172.04690989659434,
            ],
            [
              47.30957775492126,
              168.43492134596588,
            ],
            [
              46.3386630179506,
              160.54259107232966,
            ],
            [
              49.202844446593296,
              153.2402160926003,
            ],
            [
              53.180748764448865,
              147.44703936037027,
            ],
            [
              54.9495899559282,
              145.39344791460775,
            ],
            [
              56.8774788252341,
              143.41892437969898,
            ],
            [
              58.97158482533759,
              141.53028695153603,
            ],
            [
              61.23921332869881,
              139.73448309529437,
            ],
            [
              63.68780562697626,
              138.0385895443266,
            ],
            [
              66.32493893077297,
              136.44981229919782,
            ],
            [
              69.1535844240032,
              134.9907736654309,
            ],
            [
              72.10941134425099,
              133.8117524942583,
            ],
            [
              75.17451320029508,
              132.9671061358115,
            ],
            [
              78.35180398922122,
              132.47987074174844,
            ],
            [
              81.64425923662893,
              132.3735689136763,
            ],
            [
              85.0549159970002,
              132.6722097014267,
            ],
            [
              88.84621539639582,
              133.4959058421928,
            ],
            [
              93.13397532372831,
              135.35476109533968,
            ],
            [
              97.37963547338721,
              138.3262959001408,
            ],
            [
              101.57393111066656,
              142.48205447480854,
            ],
            [
              105.70739342857802,
              147.895156883028,
            ],
            [
              111.09015634579525,
              157.925328682147,
            ],
            [
              115.93172618217102,
              172.10486670209932,
            ],
            [
              119.94023,
              190.33333,
            ],
          ],
          "spatial": {
            "height": 106.99999999999999,
            "unit": "pixel",
            "width": 153.6613469820494,
            "x": 46.3386630179506,
            "y": 83.33333,
          },
          "style": {
            "fill": "#fff",
            "stroke": "#000",
          },
          "svg": "<svg width="800" height="600" xmlns="http://www.w3.org/2000/svg"><g><path d="m200.00001,83.33333c-270.12536,222.67568 -108.78352,-65.06757 -80.05978,107"></path></g></svg>",
          "svgShape": "path",
          "type": "SvgSelector",
        },
        "selectors": [
          {
            "points": [
              [
                200.00001,
                83.33333,
              ],
              [
                189.0497197575205,
                92.24393388115851,
              ],
              [
                178.805670397455,
                100.43438771718232,
              ],
              [
                169.23560567208767,
                107.94149345372949,
              ],
              [
                160.30805901686495,
                114.80115206593804,
              ],
              [
                151.99235355030802,
                121.0483635582994,
              ],
              [
                144.25860207390545,
                126.71722696450647,
              ],
              [
                137.07770707198566,
                131.84094034726937,
              ],
              [
                130.4213607115608,
                136.45180079809205,
              ],
              [
                123.61277681832797,
                141.00964477236283,
              ],
              [
                113.97516170198546,
                147.21988073927787,
              ],
              [
                105.3319030967066,
                152.52755936098924,
              ],
              [
                97.61454532645207,
                157.00342065751718,
              ],
              [
                90.75699356146032,
                160.71576500806725,
              ],
              [
                84.69551381892782,
                163.7304531473643,
              ],
              [
                79.36873296390102,
                166.11090616086344,
              ],
              [
                71.80644334525853,
                168.98320166402587,
              ],
              [
                64.26398773055817,
                171.19491342158602,
              ],
              [
                58.37447362500575,
                172.16184015700756,
              ],
              [
                53.9520687744154,
                172.04690989659434,
              ],
              [
                47.30957775492126,
                168.43492134596588,
              ],
              [
                46.3386630179506,
                160.54259107232966,
              ],
              [
                49.202844446593296,
                153.2402160926003,
              ],
              [
                53.180748764448865,
                147.44703936037027,
              ],
              [
                54.9495899559282,
                145.39344791460775,
              ],
              [
                56.8774788252341,
                143.41892437969898,
              ],
              [
                58.97158482533759,
                141.53028695153603,
              ],
              [
                61.23921332869881,
                139.73448309529437,
              ],
              [
                63.68780562697626,
                138.0385895443266,
              ],
              [
                66.32493893077297,
                136.44981229919782,
              ],
              [
                69.1535844240032,
                134.9907736654309,
              ],
              [
                72.10941134425099,
                133.8117524942583,
              ],
              [
                75.17451320029508,
                132.9671061358115,
              ],
              [
                78.35180398922122,
                132.47987074174844,
              ],
              [
                81.64425923662893,
                132.3735689136763,
              ],
              [
                85.0549159970002,
                132.6722097014267,
              ],
              [
                88.84621539639582,
                133.4959058421928,
              ],
              [
                93.13397532372831,
                135.35476109533968,
              ],
              [
                97.37963547338721,
                138.3262959001408,
              ],
              [
                101.57393111066656,
                142.48205447480854,
              ],
              [
                105.70739342857802,
                147.895156883028,
              ],
              [
                111.09015634579525,
                157.925328682147,
              ],
              [
                115.93172618217102,
                172.10486670209932,
              ],
              [
                119.94023,
                190.33333,
              ],
            ],
            "spatial": {
              "height": 106.99999999999999,
              "unit": "pixel",
              "width": 153.6613469820494,
              "x": 46.3386630179506,
              "y": 83.33333,
            },
            "style": {
              "fill": "#fff",
              "stroke": "#000",
            },
            "svg": "<svg width="800" height="600" xmlns="http://www.w3.org/2000/svg"><g><path d="m200.00001,83.33333c-270.12536,222.67568 -108.78352,-65.06757 -80.05978,107"></path></g></svg>",
            "svgShape": "path",
            "type": "SvgSelector",
          },
        ],
      }
    `);
    });

    test('Parsing a quadratic bézier selector', () => {
      expect(
        parseSelector({
          type: 'SvgSelector',
          value:
            '<svg width="800" height="600" xmlns="http://www.w3.org/2000/svg"><g><path d="m200.00001,83.33333 q -270.12536,222.67568 -108.78352,-65.06757" stroke="#000" fill="#fff"/></g></svg>',
        })
      ).toMatchInlineSnapshot(`
      {
        "selector": {
          "points": [
            [
              200.00001,
              83.33333,
            ],
            [
              162.4534128906872,
              113.44052265292322,
            ],
            [
              130.23963379446013,
              137.53241475664169,
            ],
            [
              103.07514493892985,
              155.9444151903508,
            ],
            [
              80.6823522931036,
              169.00491330697372,
            ],
            [
              62.78959556984875,
              177.0352789297825,
            ],
            [
              49.13114822877719,
              180.3498623484449,
            ],
            [
              39.44721747962866,
              179.25599431438627,
            ],
            [
              33.48394428625797,
              174.0539860353251,
            ],
            [
              30.99340337134864,
              165.03712916881153,
            ],
            [
              31.733603222011542,
              152.49169581455482,
            ],
            [
              35.46848609646122,
              136.69693850527307,
            ],
            [
              41.96792803201417,
              117.9250901957326,
            ],
            [
              51.00773885471672,
              96.44136424955366,
            ],
            [
              62.36966219099256,
              72.50395442325019,
            ],
            [
              75.84137548180844,
              46.36403484681894,
            ],
            [
              91.21649000000001,
              18.26576,
            ],
          ],
          "spatial": {
            "height": 162.0841023484449,
            "unit": "pixel",
            "width": 169.00660662865135,
            "x": 30.99340337134864,
            "y": 18.26576,
          },
          "style": {
            "fill": "#fff",
            "stroke": "#000",
          },
          "svg": "<svg width="800" height="600" xmlns="http://www.w3.org/2000/svg"><g><path d="m200.00001,83.33333 q -270.12536,222.67568 -108.78352,-65.06757"></path></g></svg>",
          "svgShape": "path",
          "type": "SvgSelector",
        },
        "selectors": [
          {
            "points": [
              [
                200.00001,
                83.33333,
              ],
              [
                162.4534128906872,
                113.44052265292322,
              ],
              [
                130.23963379446013,
                137.53241475664169,
              ],
              [
                103.07514493892985,
                155.9444151903508,
              ],
              [
                80.6823522931036,
                169.00491330697372,
              ],
              [
                62.78959556984875,
                177.0352789297825,
              ],
              [
                49.13114822877719,
                180.3498623484449,
              ],
              [
                39.44721747962866,
                179.25599431438627,
              ],
              [
                33.48394428625797,
                174.0539860353251,
              ],
              [
                30.99340337134864,
                165.03712916881153,
              ],
              [
                31.733603222011542,
                152.49169581455482,
              ],
              [
                35.46848609646122,
                136.69693850527307,
              ],
              [
                41.96792803201417,
                117.9250901957326,
              ],
              [
                51.00773885471672,
                96.44136424955366,
              ],
              [
                62.36966219099256,
                72.50395442325019,
              ],
              [
                75.84137548180844,
                46.36403484681894,
              ],
              [
                91.21649000000001,
                18.26576,
              ],
            ],
            "spatial": {
              "height": 162.0841023484449,
              "unit": "pixel",
              "width": 169.00660662865135,
              "x": 30.99340337134864,
              "y": 18.26576,
            },
            "style": {
              "fill": "#fff",
              "stroke": "#000",
            },
            "svg": "<svg width="800" height="600" xmlns="http://www.w3.org/2000/svg"><g><path d="m200.00001,83.33333 q -270.12536,222.67568 -108.78352,-65.06757"></path></g></svg>",
            "svgShape": "path",
            "type": "SvgSelector",
          },
        ],
      }
    `);
    });

    test('Parsing a polygon selector', () => {
      expect(
        parseSelector({
          type: 'SvgSelector',
          value:
            '<svg width="800" height="600" xmlns="http://www.w3.org/2000/svg"><g><polygon points="100,100 150,25 150,75 200,0" stroke="#000" fill="#fff"/></g></svg>',
        })
      ).toMatchInlineSnapshot(`
      {
        "selector": {
          "points": [
            [
              100,
              100,
            ],
            [
              150,
              25,
            ],
            [
              150,
              75,
            ],
            [
              200,
              0,
            ],
            [
              100,
              100,
            ],
          ],
          "spatial": {
            "height": 100,
            "unit": "pixel",
            "width": 100,
            "x": 100,
            "y": 0,
          },
          "style": {
            "fill": "#fff",
            "stroke": "#000",
          },
          "svg": "<svg width="800" height="600" xmlns="http://www.w3.org/2000/svg"><g><polygon points="100,100 150,25 150,75 200,0"></polygon></g></svg>",
          "svgShape": "polygon",
          "type": "SvgSelector",
        },
        "selectors": [
          {
            "points": [
              [
                100,
                100,
              ],
              [
                150,
                25,
              ],
              [
                150,
                75,
              ],
              [
                200,
                0,
              ],
              [
                100,
                100,
              ],
            ],
            "spatial": {
              "height": 100,
              "unit": "pixel",
              "width": 100,
              "x": 100,
              "y": 0,
            },
            "style": {
              "fill": "#fff",
              "stroke": "#000",
            },
            "svg": "<svg width="800" height="600" xmlns="http://www.w3.org/2000/svg"><g><polygon points="100,100 150,25 150,75 200,0"></polygon></g></svg>",
            "svgShape": "polygon",
            "type": "SvgSelector",
          },
        ],
      }
    `);
    });

    test('Parsing a polyline selector', () => {
      expect(
        parseSelector({
          type: 'SvgSelector',
          value:
            '<svg width="800" height="600" xmlns="http://www.w3.org/2000/svg"><g><polyline points="100,100 150,25 150,75 200,0" stroke="#000" fill="#fff"/></g></svg>',
        })
      ).toMatchInlineSnapshot(`
      {
        "selector": {
          "points": [
            [
              100,
              100,
            ],
            [
              150,
              25,
            ],
            [
              150,
              75,
            ],
            [
              200,
              0,
            ],
          ],
          "spatial": {
            "height": 100,
            "unit": "pixel",
            "width": 100,
            "x": 100,
            "y": 0,
          },
          "style": {
            "fill": "#fff",
            "stroke": "#000",
          },
          "svg": "<svg width="800" height="600" xmlns="http://www.w3.org/2000/svg"><g><polyline points="100,100 150,25 150,75 200,0"></polyline></g></svg>",
          "svgShape": "polyline",
          "type": "SvgSelector",
        },
        "selectors": [
          {
            "points": [
              [
                100,
                100,
              ],
              [
                150,
                25,
              ],
              [
                150,
                75,
              ],
              [
                200,
                0,
              ],
            ],
            "spatial": {
              "height": 100,
              "unit": "pixel",
              "width": 100,
              "x": 100,
              "y": 0,
            },
            "style": {
              "fill": "#fff",
              "stroke": "#000",
            },
            "svg": "<svg width="800" height="600" xmlns="http://www.w3.org/2000/svg"><g><polyline points="100,100 150,25 150,75 200,0"></polyline></g></svg>",
            "svgShape": "polyline",
            "type": "SvgSelector",
          },
        ],
      }
    `);
    });

    test('Parsing the cookbook polygon selector', () => {
      expect(
        parseSelector({
          type: 'SvgSelector',
          value:
            "<svg xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink'><g><path d='M270.000000,1900.000000 L1530.000000,1900.000000 L1530.000000,1610.000000 L1315.000000,1300.000000 L1200.000000,986.000000 L904.000000,661.000000 L600.000000,986.000000 L500.000000,1300.000000 L270,1630 L270.000000,1900.000000' /></g></svg>",
        })
      ).toMatchInlineSnapshot(`
      {
        "selector": {
          "points": [
            [
              270,
              1900,
            ],
            [
              1530,
              1900,
            ],
            [
              1530,
              1610,
            ],
            [
              1315,
              1300,
            ],
            [
              1200,
              986,
            ],
            [
              904,
              661,
            ],
            [
              600,
              986,
            ],
            [
              500,
              1300,
            ],
            [
              270,
              1630,
            ],
            [
              270,
              1900,
            ],
          ],
          "spatial": {
            "height": 1239,
            "unit": "pixel",
            "width": 1260,
            "x": 270,
            "y": 661,
          },
          "style": undefined,
          "svg": "<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><g><path d="M270.000000,1900.000000 L1530.000000,1900.000000 L1530.000000,1610.000000 L1315.000000,1300.000000 L1200.000000,986.000000 L904.000000,661.000000 L600.000000,986.000000 L500.000000,1300.000000 L270,1630 L270.000000,1900.000000"></path></g></svg>",
          "svgShape": "polygon",
          "type": "SvgSelector",
        },
        "selectors": [
          {
            "points": [
              [
                270,
                1900,
              ],
              [
                1530,
                1900,
              ],
              [
                1530,
                1610,
              ],
              [
                1315,
                1300,
              ],
              [
                1200,
                986,
              ],
              [
                904,
                661,
              ],
              [
                600,
                986,
              ],
              [
                500,
                1300,
              ],
              [
                270,
                1630,
              ],
              [
                270,
                1900,
              ],
            ],
            "spatial": {
              "height": 1239,
              "unit": "pixel",
              "width": 1260,
              "x": 270,
              "y": 661,
            },
            "style": undefined,
            "svg": "<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><g><path d="M270.000000,1900.000000 L1530.000000,1900.000000 L1530.000000,1610.000000 L1315.000000,1300.000000 L1200.000000,986.000000 L904.000000,661.000000 L600.000000,986.000000 L500.000000,1300.000000 L270,1630 L270.000000,1900.000000"></path></g></svg>",
            "svgShape": "polygon",
            "type": "SvgSelector",
          },
        ],
      }
    `);
    });

    test('Parsing a cubic bézier selector with jsdom', () => {
      expect(
        parseSelector(
          {
            type: 'SvgSelector',
            value:
              '<svg width="800" height="600" xmlns="http://www.w3.org/2000/svg"><g><path d="m200.00001,83.33333c-270.12536,222.67568 -108.78352,-65.06757 -80.05978,107" stroke="#000" fill="#fff"/></g></svg>',
          },
          { domParser: new new JSDOM().window.DOMParser() }
        )
      ).toMatchInlineSnapshot(`
      {
        "selector": {
          "points": [
            [
              200.00001,
              83.33333,
            ],
            [
              189.0497197575205,
              92.24393388115851,
            ],
            [
              178.805670397455,
              100.43438771718232,
            ],
            [
              169.23560567208767,
              107.94149345372949,
            ],
            [
              160.30805901686495,
              114.80115206593804,
            ],
            [
              151.99235355030802,
              121.0483635582994,
            ],
            [
              144.25860207390545,
              126.71722696450647,
            ],
            [
              137.07770707198566,
              131.84094034726937,
            ],
            [
              130.4213607115608,
              136.45180079809205,
            ],
            [
              123.61277681832797,
              141.00964477236283,
            ],
            [
              113.97516170198546,
              147.21988073927787,
            ],
            [
              105.3319030967066,
              152.52755936098924,
            ],
            [
              97.61454532645207,
              157.00342065751718,
            ],
            [
              90.75699356146032,
              160.71576500806725,
            ],
            [
              84.69551381892782,
              163.7304531473643,
            ],
            [
              79.36873296390102,
              166.11090616086344,
            ],
            [
              71.80644334525853,
              168.98320166402587,
            ],
            [
              64.26398773055817,
              171.19491342158602,
            ],
            [
              58.37447362500575,
              172.16184015700756,
            ],
            [
              53.9520687744154,
              172.04690989659434,
            ],
            [
              47.30957775492126,
              168.43492134596588,
            ],
            [
              46.3386630179506,
              160.54259107232966,
            ],
            [
              49.202844446593296,
              153.2402160926003,
            ],
            [
              53.180748764448865,
              147.44703936037027,
            ],
            [
              54.9495899559282,
              145.39344791460775,
            ],
            [
              56.8774788252341,
              143.41892437969898,
            ],
            [
              58.97158482533759,
              141.53028695153603,
            ],
            [
              61.23921332869881,
              139.73448309529437,
            ],
            [
              63.68780562697626,
              138.0385895443266,
            ],
            [
              66.32493893077297,
              136.44981229919782,
            ],
            [
              69.1535844240032,
              134.9907736654309,
            ],
            [
              72.10941134425099,
              133.8117524942583,
            ],
            [
              75.17451320029508,
              132.9671061358115,
            ],
            [
              78.35180398922122,
              132.47987074174844,
            ],
            [
              81.64425923662893,
              132.3735689136763,
            ],
            [
              85.0549159970002,
              132.6722097014267,
            ],
            [
              88.84621539639582,
              133.4959058421928,
            ],
            [
              93.13397532372831,
              135.35476109533968,
            ],
            [
              97.37963547338721,
              138.3262959001408,
            ],
            [
              101.57393111066656,
              142.48205447480854,
            ],
            [
              105.70739342857802,
              147.895156883028,
            ],
            [
              111.09015634579525,
              157.925328682147,
            ],
            [
              115.93172618217102,
              172.10486670209932,
            ],
            [
              119.94023,
              190.33333,
            ],
          ],
          "spatial": {
            "height": 106.99999999999999,
            "unit": "pixel",
            "width": 153.6613469820494,
            "x": 46.3386630179506,
            "y": 83.33333,
          },
          "style": {
            "fill": "#fff",
            "stroke": "#000",
          },
          "svg": "<svg width="800" height="600" xmlns="http://www.w3.org/2000/svg"><g><path d="m200.00001,83.33333c-270.12536,222.67568 -108.78352,-65.06757 -80.05978,107"/></g></svg>",
          "svgShape": "path",
          "type": "SvgSelector",
        },
        "selectors": [
          {
            "points": [
              [
                200.00001,
                83.33333,
              ],
              [
                189.0497197575205,
                92.24393388115851,
              ],
              [
                178.805670397455,
                100.43438771718232,
              ],
              [
                169.23560567208767,
                107.94149345372949,
              ],
              [
                160.30805901686495,
                114.80115206593804,
              ],
              [
                151.99235355030802,
                121.0483635582994,
              ],
              [
                144.25860207390545,
                126.71722696450647,
              ],
              [
                137.07770707198566,
                131.84094034726937,
              ],
              [
                130.4213607115608,
                136.45180079809205,
              ],
              [
                123.61277681832797,
                141.00964477236283,
              ],
              [
                113.97516170198546,
                147.21988073927787,
              ],
              [
                105.3319030967066,
                152.52755936098924,
              ],
              [
                97.61454532645207,
                157.00342065751718,
              ],
              [
                90.75699356146032,
                160.71576500806725,
              ],
              [
                84.69551381892782,
                163.7304531473643,
              ],
              [
                79.36873296390102,
                166.11090616086344,
              ],
              [
                71.80644334525853,
                168.98320166402587,
              ],
              [
                64.26398773055817,
                171.19491342158602,
              ],
              [
                58.37447362500575,
                172.16184015700756,
              ],
              [
                53.9520687744154,
                172.04690989659434,
              ],
              [
                47.30957775492126,
                168.43492134596588,
              ],
              [
                46.3386630179506,
                160.54259107232966,
              ],
              [
                49.202844446593296,
                153.2402160926003,
              ],
              [
                53.180748764448865,
                147.44703936037027,
              ],
              [
                54.9495899559282,
                145.39344791460775,
              ],
              [
                56.8774788252341,
                143.41892437969898,
              ],
              [
                58.97158482533759,
                141.53028695153603,
              ],
              [
                61.23921332869881,
                139.73448309529437,
              ],
              [
                63.68780562697626,
                138.0385895443266,
              ],
              [
                66.32493893077297,
                136.44981229919782,
              ],
              [
                69.1535844240032,
                134.9907736654309,
              ],
              [
                72.10941134425099,
                133.8117524942583,
              ],
              [
                75.17451320029508,
                132.9671061358115,
              ],
              [
                78.35180398922122,
                132.47987074174844,
              ],
              [
                81.64425923662893,
                132.3735689136763,
              ],
              [
                85.0549159970002,
                132.6722097014267,
              ],
              [
                88.84621539639582,
                133.4959058421928,
              ],
              [
                93.13397532372831,
                135.35476109533968,
              ],
              [
                97.37963547338721,
                138.3262959001408,
              ],
              [
                101.57393111066656,
                142.48205447480854,
              ],
              [
                105.70739342857802,
                147.895156883028,
              ],
              [
                111.09015634579525,
                157.925328682147,
              ],
              [
                115.93172618217102,
                172.10486670209932,
              ],
              [
                119.94023,
                190.33333,
              ],
            ],
            "spatial": {
              "height": 106.99999999999999,
              "unit": "pixel",
              "width": 153.6613469820494,
              "x": 46.3386630179506,
              "y": 83.33333,
            },
            "style": {
              "fill": "#fff",
              "stroke": "#000",
            },
            "svg": "<svg width="800" height="600" xmlns="http://www.w3.org/2000/svg"><g><path d="m200.00001,83.33333c-270.12536,222.67568 -108.78352,-65.06757 -80.05978,107"/></g></svg>",
            "svgShape": "path",
            "type": "SvgSelector",
          },
        ],
      }
    `);
    });

    test('Parsing a real world example selector', () => {
      const annotations: any[] = ghentChoices.items[0]!.annotations[0].items;

      const firstTarget = annotations[0].target;

      expect(expandTarget(firstTarget)).toMatchInlineSnapshot(`
        {
          "selector": {
            "points": [
              [
                905.7663277587891,
                824.1576701660156,
              ],
              [
                891.7238851318359,
                878.9430197753907,
              ],
              [
                890.8197407226562,
                905.6661394042969,
              ],
              [
                825.7214197998047,
                905.6661394042969,
              ],
              [
                798.2355216064453,
                852.1408363037109,
              ],
              [
                827.1680661621094,
                820.3150755615235,
              ],
              [
                883.5865854492188,
                801.5089024658204,
              ],
              [
                905.7663277587891,
                824.1576701660156,
              ],
            ],
            "spatial": {
              "height": 104.15723693847656,
              "unit": "pixel",
              "width": 107.53080615234376,
              "x": 798.2355216064453,
              "y": 801.5089024658204,
            },
            "style": undefined,
            "svg": "<svg><path d="M905.7663277587891,824.1576701660156 891.7238851318359,878.9430197753907 890.8197407226562,905.6661394042969 825.7214197998047,905.6661394042969 798.2355216064453,852.1408363037109 827.1680661621094,820.3150755615235 883.5865854492188,801.5089024658204z"></path></svg>",
            "svgShape": "polygon",
            "type": "SvgSelector",
          },
          "selectors": [
            {
              "points": [
                [
                  905.7663277587891,
                  824.1576701660156,
                ],
                [
                  891.7238851318359,
                  878.9430197753907,
                ],
                [
                  890.8197407226562,
                  905.6661394042969,
                ],
                [
                  825.7214197998047,
                  905.6661394042969,
                ],
                [
                  798.2355216064453,
                  852.1408363037109,
                ],
                [
                  827.1680661621094,
                  820.3150755615235,
                ],
                [
                  883.5865854492188,
                  801.5089024658204,
                ],
                [
                  905.7663277587891,
                  824.1576701660156,
                ],
              ],
              "spatial": {
                "height": 104.15723693847656,
                "unit": "pixel",
                "width": 107.53080615234376,
                "x": 798.2355216064453,
                "y": 801.5089024658204,
              },
              "style": undefined,
              "svg": "<svg><path d="M905.7663277587891,824.1576701660156 891.7238851318359,878.9430197753907 890.8197407226562,905.6661394042969 825.7214197998047,905.6661394042969 798.2355216064453,852.1408363037109 827.1680661621094,820.3150755615235 883.5865854492188,801.5089024658204z"></path></svg>",
              "svgShape": "polygon",
              "type": "SvgSelector",
            },
          ],
          "source": "https://iiif.ghentcdh.ugent.be/iiif/manifests/cune-iiif-orm:sde:O.0219/canvas/0001",
          "type": "SpecificResource",
        }
      `);
    });

    test('Parsing svg target', () => {
      const target = {
        source: 'https://data.globalise.huygens.knaw.nl/manifests/maps/4.VEL/B/B.3/B.3.3/229.json/canvas/p1',
        selector: {
          type: 'SvgSelector',
          value:
            '<svg xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" fill="#FF0055" stroke="#FF0055" stroke-width="1" fill-opacity="0.1" d="M 29234,89 Z"/></svg>',
        },
      };

      expect(expandTarget(target as any)).toMatchInlineSnapshot(`
        {
          "selector": {
            "points": [
              [
                29234,
                89,
              ],
              [
                29234,
                89,
              ],
            ],
            "spatial": {
              "height": 0,
              "unit": "pixel",
              "width": 0,
              "x": 29234,
              "y": 89,
            },
            "style": {
              "fill": "#FF0055",
              "fillOpacity": 0.1,
              "stroke": "#FF0055",
              "strokeWidth": "1",
            },
            "svg": "<svg xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M 29234,89 Z"></path></svg>",
            "svgShape": "polygon",
            "type": "SvgSelector",
          },
          "selectors": [
            {
              "points": [
                [
                  29234,
                  89,
                ],
                [
                  29234,
                  89,
                ],
              ],
              "spatial": {
                "height": 0,
                "unit": "pixel",
                "width": 0,
                "x": 29234,
                "y": 89,
              },
              "style": {
                "fill": "#FF0055",
                "fillOpacity": 0.1,
                "stroke": "#FF0055",
                "strokeWidth": "1",
              },
              "svg": "<svg xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M 29234,89 Z"></path></svg>",
              "svgShape": "polygon",
              "type": "SvgSelector",
            },
          ],
          "source": "https://data.globalise.huygens.knaw.nl/manifests/maps/4.VEL/B/B.3/B.3.3/229.json/canvas/p1",
          "type": "SpecificResource",
        }
      `);
    });
  });

  describe('temporal selectors', () => {
    test('temporal with start only', () => {
      const selector: Selector = {
        type: 'FragmentSelector',
        value: 't=10.5',
      };

      expect(parseSelector(selector)).toMatchInlineSnapshot(`
        {
          "selector": {
            "temporal": {
              "endTime": undefined,
              "startTime": 10.5,
            },
            "type": "TemporalSelector",
          },
          "selectors": [
            {
              "temporal": {
                "endTime": undefined,
                "startTime": 10.5,
              },
              "type": "TemporalSelector",
            },
          ],
        }
      `);
    });
    test('temporal with start and end', () => {
      const selector: Selector = {
        type: 'FragmentSelector',
        value: 't=10.5,20.5',
      };

      expect(parseSelector(selector)).toMatchInlineSnapshot(`
        {
          "selector": {
            "temporal": {
              "endTime": 20.5,
              "startTime": 10.5,
            },
            "type": "TemporalSelector",
          },
          "selectors": [
            {
              "temporal": {
                "endTime": 20.5,
                "startTime": 10.5,
              },
              "type": "TemporalSelector",
            },
          ],
        }
      `);
    });

    test('temporal with start offset', () => {
      const selector: Selector = {
        type: 'FragmentSelector',
        value: 't=302.05,3971.24',
      };

      expect(parseSelector(selector)).toMatchInlineSnapshot(`
        {
          "selector": {
            "temporal": {
              "endTime": 3971.24,
              "startTime": 302.05,
            },
            "type": "TemporalSelector",
          },
          "selectors": [
            {
              "temporal": {
                "endTime": 3971.24,
                "startTime": 302.05,
              },
              "type": "TemporalSelector",
            },
          ],
        }
      `);
    });

    test('temporal with start and end decimals', () => {
      const selector: Selector = {
        type: 'FragmentSelector',
        value: 't=0.1,302.05',
      };

      expect(parseSelector(selector)).toMatchInlineSnapshot(`
        {
          "selector": {
            "temporal": {
              "endTime": 302.05,
              "startTime": 0.1,
            },
            "type": "TemporalSelector",
          },
          "selectors": [
            {
              "temporal": {
                "endTime": 302.05,
                "startTime": 0.1,
              },
              "type": "TemporalSelector",
            },
          ],
        }
      `);
    });
  });

  describe('temporal box selector', () => {
    test('temporal box selector', () => {
      const target =
        'https://preview.iiif.io/cookbook/0489-multimedia-canvas/recipe/0489-multimedia-canvas/canvas#xywh=200,200,480,360&t=27,57';

      const expanded = expandTarget(target);

      expect(expanded).toMatchInlineSnapshot(`
        {
          "selector": {
            "spatial": {
              "height": 360,
              "unit": "pixel",
              "width": 480,
              "x": 200,
              "y": 200,
            },
            "temporal": {
              "endTime": 57,
              "startTime": 27,
            },
            "type": "TemporalBoxSelector",
          },
          "selectors": [
            {
              "spatial": {
                "height": 360,
                "unit": "pixel",
                "width": 480,
                "x": 200,
                "y": 200,
              },
              "temporal": {
                "endTime": 57,
                "startTime": 27,
              },
              "type": "TemporalBoxSelector",
            },
          ],
          "source": {
            "id": "https://preview.iiif.io/cookbook/0489-multimedia-canvas/recipe/0489-multimedia-canvas/canvas",
            "type": "Unknown",
          },
          "type": "SpecificResource",
        }
      `);
    });
  });

  describe('point selector', () => {
    test('point selector', () => {
      const examplePointSelector: Selector = {
        type: 'PointSelector',
        x: 3385,
        y: 1464,
      };

      expect(parseSelector(examplePointSelector)).toMatchInlineSnapshot(`
        {
          "selector": {
            "spatial": {
              "x": 3385,
              "y": 1464,
            },
            "type": "PointSelector",
          },
          "selectors": [
            {
              "spatial": {
                "x": 3385,
                "y": 1464,
              },
              "type": "PointSelector",
            },
          ],
        }
      `);
    });
  });
});
